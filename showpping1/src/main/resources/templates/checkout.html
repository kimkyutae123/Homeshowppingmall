<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê²°ì œí•˜ê¸° | ìœ í•œ ì˜· ë§ˆì¼“</title>
    <link rel="stylesheet" th:href="@{/style/style.css}"> 
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet" />
    <style>
    
        /* í—¤ë” ìŠ¤íƒ€ì¼ì€ cart.htmlì˜ style.cssì— ì •ì˜ë˜ì–´ ìˆë‹¤ê³  ê°€ì • */
        
        .checkout-main {
            max-width: 1100px;
            margin: 40px auto;
            padding: 0 20px;
        }

        .checkout-card {
            background-color: #fff;
            padding: 25px;
            border-radius: 8px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.05);
            margin-bottom: 25px;
        }
        
        .card-header-title {
            font-size: 1.15rem; /* ì œëª© í¬ê¸° ì¡°ì • */
            font-weight: 600;
            color: #333;
            border-bottom: 1px solid #eee;
            padding-bottom: 10px;
            margin-bottom: 15px;
        }
        
        /* ì£¼ë¬¸ ìƒí’ˆ ëª©ë¡ */
        .item-row {
            display: flex;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px dashed #eee;
        }
        
        .item-image {
            width: 70px; /* ì´ë¯¸ì§€ í¬ê¸° ì¡°ì • */
            height: 70px;
            object-fit: cover;
            border-radius: 4px;
            margin-right: 15px;
        }

        /* â­ï¸ ê¸€ì í¬ê¸° ì¡°ì • â­ï¸ */
        .item-info h6 {
            font-size: 0.95rem; /* ìƒí’ˆëª… í¬ê¸° */
            font-weight: 600;
            margin-bottom: 2px;
        }
        
        .item-details p {
            font-size: 0.85rem; /* ê°€ê²©, ìˆ˜ëŸ‰ í¬ê¸° */
            margin-bottom: 0;
        }

        /* ê°œë³„ í•©ê³„ */
        .item-total {
            font-size: 0.95rem;
            font-weight: bold;
            color: #e74c3c;
            margin-left: auto;
        }
        
        /* ê²°ì œ ë°©ë²• ì„¹ì…˜ */
        .payment-method {
            border: 1px solid #ddd;
            border-radius: 6px;
            padding: 12px;
            margin: 8px 0;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 0.9rem;
        }
        
        .payment-method:hover {
            border-color: #007bff;
            background-color: #f5faff;
        }
        
        .payment-method.selected {
            border: 2px solid #007bff;
            background-color: #eaf2ff;
        }

        /* ì£¼ë¬¸ ìš”ì•½ */
        .summary-row {
            display: flex;
            justify-content: space-between;
            font-size: 0.95rem;
            padding: 5px 0;
        }

        .summary-total {
            font-size: 1.1rem; /* ì´ ê²°ì œ ê¸ˆì•¡ í¬ê¸° ì¡°ì • */
            font-weight: bold;
            color: #28a745;
            padding-top: 10px;
        }
        
        /* ë²„íŠ¼ ì»¨í…Œì´ë„ˆ */
        .action-container {
            text-align: center;
            margin-top: 30px;
        }

        /* â­ï¸ ë²„íŠ¼ í¬ê¸° ë° ìŠ¤íƒ€ì¼ ì¡°ì • â­ï¸ */
        .btn-checkout {
            background-color: #28a745; 
            color: white;
            padding: 10px 20px;
            font-size: 1rem;
            font-weight: 600;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: background-color 0.2s;
            text-decoration: none; /* a íƒœê·¸ì¼ ê²½ìš° */
            display: inline-block;
        }
        .btn-continue {
            background-color: #6c757d;
            color: white;
            padding: 10px 20px;
            font-size: 1rem;
            font-weight: 600;
            border: none;
            border-radius: 6px;
            margin-left: 10px;
            text-decoration: none;
            display: inline-block;
            cursor: pointer;
        }
    </style>
</head>
<body>
	<div th:if="${successMessage}" class="alert alert-success" role="alert" 
	         style="text-align: center; margin: 20px auto; max-width: 90%; padding: 15px; border-radius: 8px;">
	        <span th:text="${successMessage}">ê²°ì œê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤! ê°ì‚¬í•©ë‹ˆë‹¤. ğŸ˜Š</span>
	    </div>
    <header class="header">
        <div class="nav-bar">
            <div class="logo">
               <h1 style="margin: 0;">ìœ í•œ ì˜· ë§ˆì¼“</h1>
            </div>
            
            <div class="search-and-user">
                <a th:href="@{/}" class="menu-link">í™ˆ</a>
                <a th:href="@{/shirtlist}" class="menu-link">ìƒì˜ ëª©ë¡</a>
                <a th:href="@{/cart}" class="menu-link">ì¥ë°”êµ¬ë‹ˆ</a>
                
                <div class="user-status-group">
                    <span th:if="${session.user != null}" class="user-welcome">
                        <span th:text="${session.user.username}"></span>ë‹˜, ì–´ì„œì˜¤ì„¸ìš”
                    </span>
                    
                    <a th:unless="${session.user != null}" th:href="@{/register}" class="btn btn-outline-primary btn-sm">
                        <i class="bi bi-person-plus"></i> íšŒì›ê°€ì…
                    </a>
                    <a th:unless="${session.user != null}" th:href="@{/login}" class="btn btn-primary btn-sm">
                        <i class="bi bi-box-arrow-in-right"></i> ë¡œê·¸ì¸
                    </a>
                    
                    <a th:if="${session.user != null}" th:href="@{/logout}" class="menu-link menu-link-button">
                        <i class="bi bi-box-arrow-right"></i> ë¡œê·¸ì•„ì›ƒ
                    </a>
                </div>
            </div>
        </div>
    </header>
    <main class="checkout-main">
        <h2 class="mb-4 fw-bold">
            <i class="bi bi-credit-card"></i> ê²°ì œí•˜ê¸°
        </h2>

        <form th:action="@{/order/submit}" method="post" id="checkoutForm">
            <input type="hidden" name="paymentMethod" id="selectedPaymentMethod">

            <div class="checkout-card">
                <h5 class="card-header-title"><i class="bi bi-bag"></i> ì£¼ë¬¸ ìƒí’ˆ</h5>
                
                <div th:each="item : ${cartItems}" class="item-row">
                    <img th:src="@{${item.productOption.product.imageUrl}}" alt="ìƒí’ˆ ì´ë¯¸ì§€" class="item-image" />
                    <div class="item-info">
                        <h6 th:text="${item.productOption.product.name}">ìƒí’ˆëª…</h6>
                        <p class="text-muted" th:text="'ì˜µì…˜: ' + ${item.productOption.sizeName}">ì˜µì…˜: M</p>
                        <p class="item-details">
                            <span th:text="${#numbers.formatInteger(item.productOption.product.price, 0, 'COMMA') + 'ì›'}">79,000ì›</span>
                            <span class="text-muted"> Ã— </span>
                            <span th:text="${item.quantity}">2</span>ê°œ
                        </p>
                    </div>
                    <div class="item-total">
                        <span th:text="${#numbers.formatInteger(item.productOption.product.price * item.quantity, 0, 'COMMA') + 'ì›'}">158,000ì›</span>
                    </div>
                </div>
            </div>
            
            <div class="checkout-card">
                <h5 class="card-header-title"><i class="bi bi-credit-card"></i> ê²°ì œ ë°©ë²• ì„ íƒ</h5>
                
                <div class="payment-method" onclick="selectPayment('card', this)">
                    <input type="radio" name="paymentMethodRadio" value="card" id="card" class="me-3 d-none">
                    <label for="card"><i class="bi bi-credit-card me-2"></i>ì‹ ìš©ì¹´ë“œ</label>
                </div>
                
                <div class="payment-method" onclick="selectPayment('bank', this)">
                    <input type="radio" name="paymentMethodRadio" value="bank" id="bank" class="me-3 d-none">
                    <label for="bank"><i class="bi bi-bank me-2"></i>ê³„ì¢Œì´ì²´</label>
                </div>
                
                <div class="payment-method" onclick="selectPayment('kakao', this)">
                    <input type="radio" name="paymentMethodRadio" value="kakao" id="kakao" class="me-3 d-none">
                    <label for="kakao"><i class="bi bi-phone me-2"></i>ì¹´ì¹´ì˜¤í˜ì´</label>
                </div>
            </div>

            <div class="checkout-card">
                <h5 class="card-header-title"><i class="bi bi-receipt"></i> ì£¼ë¬¸ ìš”ì•½</h5>
                
                <div class="summary-row">
                    <span>ìƒí’ˆ ê¸ˆì•¡:</span>
                    <span th:text="${#numbers.formatInteger(totalAmount - shippingFee, 0, 'COMMA') + 'ì›'}">237,300ì›</span>
                </div>
                <div class="summary-row">
                    <span>ë°°ì†¡ë¹„:</span>
                    <span th:text="${shippingFee == 0} ? 'ë¬´ë£Œ' : ${#numbers.formatInteger(shippingFee, 0, 'COMMA') + 'ì›'}">3,000ì›</span>
                </div>
                <hr>
                <div class="summary-row summary-total">
                    <span>ì´ ê²°ì œ ê¸ˆì•¡:</span>
                    <span th:text="${#numbers.formatInteger(totalAmount, 0, 'COMMA') + 'ì›'}">240,300ì›</span>
                </div>
            </div>

            <div class="action-container">
                <button type="button" class="btn-checkout" onclick="processPayment()">
                    <i class="bi bi-check-circle"></i> ê²°ì œ ì§„í–‰í•˜ê¸°
                </button>
                <a href="/" class="btn-continue">ì‡¼í•‘ ê³„ì†í•˜ê¸°</a>
            </div>
			
            
        </form>
    </main>

    <script>
    function selectPayment(method, element) {
        // ëª¨ë“  ê²°ì œ ë°©ë²•ì—ì„œ ì„ íƒ ìƒíƒœ ì œê±° ë° ë¼ë””ì˜¤ ë²„íŠ¼ ìƒíƒœ ì´ˆê¸°í™”
        document.querySelectorAll('.payment-method').forEach(el => {
            el.classList.remove('selected');
        });
        
        // ì„ íƒëœ ê²°ì œ ë°©ë²•ì— ì„ íƒ ìƒíƒœ ì¶”ê°€
        element.classList.add('selected');
        
        // Hidden í•„ë“œ ì—…ë°ì´íŠ¸ (ì„œë²„ ì „ì†¡ìš©)
        document.getElementById('selectedPaymentMethod').value = method;
    }

    function processPayment() {
        const selectedMethod = document.getElementById('selectedPaymentMethod').value;
        
        if (!selectedMethod) {
            alert('ê²°ì œ ë°©ë²•ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
            return;
        }
        
        // â­ï¸ ì£¼ë¬¸ ì œì¶œ â­ï¸
        if (confirm(`ì„ íƒí•˜ì‹  ${selectedMethod} ë°©ì‹ìœ¼ë¡œ ê²°ì œë¥¼ ì§„í–‰í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
            // ì„œë²„ì˜ ì£¼ë¬¸ ì œì¶œ ì—”ë“œí¬ì¸íŠ¸ë¡œ í¼ ì „ì†¡
            document.getElementById('checkoutForm').submit();
        }
    }
    </script>

</body>
</html>